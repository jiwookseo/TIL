# Python curriculum : week 07 day 4

2019-02-14 SSAFY 

- Django

  : Model by django ORM



## I. Django ORM

Flask의 Flask-SQLAlchemy와 같은 Django의 ORM 방식



1. Model 작성

`app/models.py`에 model class를 생성해준다.

```python
from django.db import models
class Article(models.Model):
    title=models.TextField()
    content=models.TextField()
```

id는 django가 자동으로 생성해준다.



### 2. Make migrations, migrate

```bash
$ python manage.py makemigrations
```

1. migrate 파일을 만들어준다.

   * `0001_initial.py` 과 같은 파일이 `app/migrations`에 생성된다.

     ```python
     # Generated by Django 2.1.7 on 2019-02-14 01:38
     from django.db import migrations, models
     class Migration(migrations.Migration):
         initial = True
         dependencies = [
         ]
         operations = [
             migrations.CreateModel(
                 name='Article',
                 fields=[
                     ('id', models.AutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                     ('title', models.TextField()),
                     ('content', models.TextField()),
                 ],
             ),
         ]
     ```

   * 어떤 SQL문이 실행되는 지 궁금하다면

     ```bash
     $ python manage.py sqlmigrate articles 0001
     ```

     을 실행하면,

     ```sql
     CREATE TABLE "articles_article" ("id" integer NOT NULL PRIMARY KEY AUTOINCREMENT, "title" text NOT NULL, "content" text NOT NULL);
     COMMIT;
     ```

     을 출력해준다.

```bash
$ python manage.py migrate
```

2. migrate 해 db file에 table을 만들어준다.



### 3. CRUD

1. create

   ```python
   obj=Table(**kwarg)
   obj.save()
   # or
   Table.objects.create(**kwarg)
   # 후자는 create 전에 확인할 방법이 없으므로 전자를 추천
   ```

2. read

   ```python
   Table.objects.all()
   Table.objects.first()
   Table.objects.filter(**kwarg).all()
   Tabel.objects.get(**kwarg) # Table.objects.filter(**kwarg).first() 와 같다
   Tabel.objects.order_by('field').all()
   Tabel.objects.order_by('-field').all() # reverse
   ```

   .all()은 list와 흡사하고 수많은 메소드를 가지고 있는 QuerySet을 반환해준다.

   example : `<QuerySet [<Article: Article object (1)>]>`

3. update

   ```python
   obj=Table.objects.get(id=1)
   obj.field = "what2update"
   obj.save()
   ```

4. delete

   ```python
   obj=Table.objects.get(id=1)
   obj.delete()
   ```



## II. Django Admin

MySQL을 web상에서 관리할 목적으로, php 언어로 작성된 도구가 phpmydmin라면,

Django에서는 Django Admin을 지원해 admin page에서 db 등을 쉽게 관리할 수 있다.



### 기본 설정법

1. `admin.py`에 admin 페이지에서 관리하고 싶은 model을 register하면 admin 페이지에 나타나게 된다.

    ```python
    from django.contrib import admin
    from .models import Pastlife
    
    # Register your models here.
    admin.site.register(Pastlife)
    ```

2. 관리자 계정을 만들어준다.

    ```bash
    $ python manage.py createsuperuser
    ```

3. `/admin` route로 접속해 관리자 페이지로 접근한다.

